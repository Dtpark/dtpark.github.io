---
layout: post
title: æŠ–éŸ³é¡¹ç›®ç¬”è®°â€”â€”Gin çš„æ¨¡å—æ‹†åˆ† ï½œ é’è®­è¥ç¬”è®°
categories: develop
tags: go gin
---

## ä¸€ã€èƒŒæ™¯

çœ‹å¤§å®¶æäº¤çš„æŠ–éŸ³é¡¹ç›®ä¸è®ºä½¿ç”¨å•ä½“æ¶æ„è¿˜æ˜¯å¾®æœåŠ¡æ¶æ„ï¼Œéƒ½ä½¿ç”¨äº† Gin æ¡†æ¶ ~~(èµ«å…¹å¼€æºæ™šäº†ğŸ¤)~~ã€‚å› ä¸º Gin æ¡†æ¶ä¸è‡ªå¸¦æ¨¡å—æ‹†åˆ†ï¼Œä¸ºäº†ä¾¿äºé˜…è¯»å’Œæ‰©å±•ï¼Œä¸€èˆ¬è¦å¯¹ web æ¡†æ¶å„æ¨¡å—è¿›è¡Œæ‹†åˆ†ã€‚æœ¬æ–‡åˆ†äº«ä¸€ä¸‹ç¬”è€…æ‰€åœ¨å°ç»„çš„æ‹†åˆ†æ–¹æ³•ã€‚

## äºŒã€å„æ¨¡å—è°ƒç”¨å…³ç³»


![UML å›¾-2.jpg](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c21ae5c5459a4a389d78f6dcb03ba934~tplv-k3u1fbpfcp-watermark.image?)

> æœ¬é¡¹ç›®ä½¿ç”¨çš„æ˜¯å¾®æœåŠ¡æ¶æ„ï¼Œæ•…è§†å›¾å±‚ç›´æ¥è°ƒç”¨å¾®æœåŠ¡ï¼Œè‹¥æ˜¯å•ä½“åº”ç”¨åˆ™å¾®æœåŠ¡éƒ¨åˆ†æ›¿æ¢ä¸ºé€»è¾‘å±‚ä¸æ•°æ®å±‚ã€‚

## ä¸‰ã€ç›®å½•ç»“æ„

```bash
.
â”œâ”€â”€ handlers                            # å„ API çš„ handler
â”‚   â”œâ”€â”€ comment_action.go               # è¯„è®ºæ“ä½œï¼ˆè¯„è®º/åˆ é™¤è¯„è®ºï¼‰
â”‚   â”œâ”€â”€ comment_list.go                 # è·å–è¯„è®ºåˆ—è¡¨
â”‚   â”œâ”€â”€ common.go                       # å„ handler éœ€è¦ä½¿ç”¨çš„å…¬å…±ä»£ç 
â”‚   â”œâ”€â”€ favorite_action.go              # ç‚¹èµ/å–æ¶ˆç‚¹èµ
â”‚   â”œâ”€â”€ favorite_video_list.go          # å–œæ¬¢åˆ—è¡¨
â”‚   â”œâ”€â”€ feed.go                         # è§†é¢‘æµ
â”‚   â”œâ”€â”€ login.go                        # ç™»å½•
â”‚   â”œâ”€â”€ register.go                     # æ³¨å†Œ
â”‚   â”œâ”€â”€ relation_action.go              # å…³æ³¨/å–æ¶ˆå…³æ³¨
â”‚   â”œâ”€â”€ relation_follow_list.go         # å…³æ³¨åˆ—è¡¨
â”‚   â”œâ”€â”€ relation_follower_list.go       # ç²‰ä¸åˆ—è¡¨
â”‚   â”œâ”€â”€ user_info.go                    # ç”¨æˆ·ä¿¡æ¯
â”‚   â”œâ”€â”€ video_list.go                   # å‘å¸ƒåˆ—è¡¨
â”‚   â””â”€â”€ video_publish.go                # å‘å¸ƒè§†é¢‘
â”œâ”€â”€ main.go
â”œâ”€â”€ middleware                          # ä¸­é—´ä»¶
â”‚   â””â”€â”€ auth                            # é‰´æƒä¸­é—´ä»¶
â”‚       â”œâ”€â”€ auth.go                     # ç»§æ‰¿ appleboy/gin-jwt æ’ä»¶
â”‚       â”œâ”€â”€ config.go                   # å®ä¾‹åŒ– jwt æ—¶çš„é…ç½®
â”‚       â”œâ”€â”€ form_auth.go                # é’ˆå¯¹ gin-jwt æ— æ³•è·å– form-data ä¸­ token åšçš„æ‰©å±•
â”‚       â””â”€â”€ select.go                   # å¯¹ ç™»å½•/æœªç™»å½• ç”¨æˆ·è§†é¢‘æµåˆ†åˆ«å¤„ç†å¯¹ä¸­é—´ä»¶
â”œâ”€â”€ router                              # è·¯ç”±
â”‚   â””â”€â”€ router.go
â”œâ”€â”€ rpc                                 # å°è£…å…¶ä»–å¾®æœåŠ¡çš„ client æ¥å£
â”‚   â”œâ”€â”€ comment.go
â”‚   â”œâ”€â”€ favorite.go
â”‚   â”œâ”€â”€ init.go
â”‚   â”œâ”€â”€ relation.go
â”‚   â”œâ”€â”€ user.go
â”‚   â””â”€â”€ video.go
â”œâ”€â”€ run.sh                              # å¯åŠ¨è„šæœ¬
â””â”€â”€ utils                               # å·¥å…·å‡½æ•°
    â”œâ”€â”€ upload.go                       # ä¸Šä¼ è§†é¢‘æ–¹æ³•
    â””â”€â”€ validate_file.go                # éªŒè¯å¾…ä¸Šä¼ æ–‡ä»¶ç±»å‹&ç”Ÿæˆæ–°çš„æ–‡ä»¶å
```
> è‹¥ä¸ºå•ä½“åº”ç”¨åˆ™ rpc ç›®å½•æ›¿æ¢ä¸º service ä¸ dao

## å››ã€main æ–‡ä»¶

```go
func Init() {
   tracer.InitJaeger(constants.APIServiceName)
   rpc.InitRPC()
}

func main() {
   r := gin.New()
   // å„ç§æ¨¡å—çš„åˆå§‹åŒ–
   Init()
   // æ³¨å†Œè·¯ç”±
   router.Router(r)
   // ç›‘å¬å¹¶å¯åŠ¨
   if err := http.ListenAndServe(":8080", r); err != nil {
      klog.Fatal(err)
   }
}
```
> å…¶ä»–æ–‡ä»¶è§æ–‡æœ«ä»£ç ä»“åº“ï¼š`cmd/api/`

---

çœ‹åˆ°è¿™å„¿äº†éƒ½ï¼Œå¯ä»¥æ±‚ä¸ª star å—ï¼Œ23333: [github.com/ByteDanceCaâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FByteDanceCamp%2Fmicro_tiktok "https://github.com/ByteDanceCamp/micro_tiktok")